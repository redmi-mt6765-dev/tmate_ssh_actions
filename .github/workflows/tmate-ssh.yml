name: Debug Actions

on:
  workflow_dispatch: # Manually triggered from Actions tab

jobs:
  debug:
    runs-on: ubuntu-latest
    defaults:
      run:
        shell: bash
        working-directory: /home/runner
    timeout-minutes: 360  # Max 6 hours (GitHub's hard limit)

    env:
      USERNAME: ${{ secrets.USERNAME }}
      USER_EMAIL: ${{ secrets.USER_EMAIL }}
      SSH_PRIVATE_KEY: ${{ secrets.SSH_PRIVATE_KEY }}
      GPG_PRIVATE_KEY: ${{ secrets.GPG_PRIVATE_KEY }}
      GPG_PASSPHRASE: ${{ secrets.GPG_PASSPHRASE }}

    steps:
      - name: Configure Git User
        run: |
          git config --global user.name "${{ env.USERNAME }}"
          git config --global user.email "${{ env.USER_EMAIL }}"

      - name: Import SSH Key
        run: |
          mkdir -p ~/.ssh
          echo "${{ env.SSH_PRIVATE_KEY }}" > ~/.ssh/id_ed25519
          chmod 600 ~/.ssh/id_ed25519
          eval "$(ssh-agent -s)"
          ssh-add ~/.ssh/id_ed25519
          echo "SSH key configured."

      - name: Import GPG Key
        run: |
          echo "${{ env.GPG_PRIVATE_KEY }}" | gpg --batch --import
          GPG_KEY_ID=$(gpg --list-secret-keys --keyid-format=long | awk '/sec/{print $2}' | cut -d'/' -f2 | head -n1)
          git config --global user.signingkey "$GPG_KEY_ID"
          git config --global commit.gpgsign true
          echo "${{ env.GPG_PASSPHRASE }}" | gpg --batch --yes --pinentry-mode loopback --passphrase-fd 0 --sign --detach-sign
          echo "GPG key configured for signing."

      - name: Start tmate session üß†
        uses: mxschmitt/action-tmate@v3

      - name: Sleep ‚ôæÔ∏è
        run: |
          if [ -f /continue ]; then
              echo "-- Done debugging!"
          else
              sleep infinity
